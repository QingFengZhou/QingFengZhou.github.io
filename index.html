<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://qingfengzhou.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://qingfengzhou.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-system/linux/vmware/vmware扩容" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/17/system/linux/vmware/vmware%E6%89%A9%E5%AE%B9/" class="article-date">
  <time class="dt-published" datetime="2023-11-17T15:30:48.000Z" itemprop="datePublished">2023-11-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/system-linux-vmware/">system/linux/vmware</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/17/system/linux/vmware/vmware%E6%89%A9%E5%AE%B9/">vmware扩容</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!-- toc -->

<ul>
<li><a href="#virtualbox-centos79%E6%89%A9%E5%AE%B9">virtualbox centos7.9扩容</a><ul>
<li><a href="#%E8%99%9A%E6%8B%9F%E7%B3%BB%E7%BB%9F%E7%A3%81%E7%9B%98%E6%96%87%E4%BB%B6%E6%89%A9%E5%85%85">虚拟系统磁盘文件扩充</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9%E5%88%86%E5%8C%BA">修改分区</a></li>
<li><a href="#%E9%87%8D%E5%90%AF">重启</a></li>
<li><a href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%88%86%E5%8C%BA">格式化分区</a></li>
<li><a href="#lvm%E6%9B%B4%E6%96%B0">LVM更新</a></li>
<li><a href="#%E6%89%A9%E5%AE%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">扩容文件系统</a></li>
<li><a href="#references">References:</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h2><span id="virtualbox-centos79扩容">virtualbox centos7.9扩容</span></h2><h3><span id="虚拟系统磁盘文件扩充">虚拟系统磁盘文件扩充</span></h3><p><strong>命令操作</strong></p>
<p>命令行运行<code>VBoxManage</code>，<code>modifyhd</code>扩容需要文件格式为<code>.vdi</code>，如为<code>.vmdk</code>，需要使用<code>clonehd</code>指定格式进行格式转换，详细可参考【1】。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VBoxManage modifyhd <span class="string">&quot;centos-01.vdi&quot;</span> --resize 20480</span><br></pre></td></tr></table></figure>

<p><strong>GUI操作</strong></p>
<p>关闭操作的虚拟机，在<code>Oracle VM VirtualBox</code>管理器主界面，<strong>管理-&gt;虚拟介质管理-&gt;属性-&gt;大小-&gt;应用</strong>。</p>
<h3><span id="修改分区">修改分区</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fdisk /dev/sda　　　　 </span><br><span class="line">p　　　　　　　<span class="comment">#查看已分区数量</span></span><br><span class="line">n　　　　　　　<span class="comment">#新增加一个分区</span></span><br><span class="line">p　　　　　　　<span class="comment">#分区类型选择为主分区 </span></span><br><span class="line">回车　　　　   <span class="comment">#选择分区号，使用默认，即为新增分区</span></span><br><span class="line">回车　　　　　 <span class="comment">#默认（起始扇区） </span></span><br><span class="line">回车　　　　　 <span class="comment">#默认（结束扇区） </span></span><br><span class="line">t　　　　　　　<span class="comment">#修改分区类型 </span></span><br><span class="line">回车　　　　   <span class="comment">#选分区3 </span></span><br><span class="line">8e　　　　　 　<span class="comment">#修改为LVM（8e就是LVM）</span></span><br><span class="line">w　　　　　  　<span class="comment">#写分区表并退出 </span></span><br></pre></td></tr></table></figure>

<h3><span id="重启">重启</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo reboot                <span class="comment">#重启</span></span><br></pre></td></tr></table></figure>



<h3><span id="格式化分区">格式化分区</span></h3><p>（非必要，可用于转换文件系统类型）</p>
<p>这里名称“&#x2F;dev&#x2F;sda3”与新增分区一致。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看</span></span><br><span class="line">$ sudo fdisk -l </span><br><span class="line"><span class="comment"># 格式化，还有各种 mkfs.ext4，mkfs.xfs..，与需要扩容的文件系统应该一致</span></span><br><span class="line">$ sudo mkfs.ext3 /dev/sda3</span><br></pre></td></tr></table></figure>

<h3><span id="lvm更新">LVM更新</span></h3><p>这里名称“&#x2F;dev&#x2F;sda3”与新增分区一致。</p>
<p>此虚拟机环境中需要扩容的文件系统为<code>/dev/mapper/centos-root</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ lvm　　　　　　　　　　　　              <span class="comment">#进入lvm管理</span></span><br><span class="line">$ lvm&gt;pvcreate /dev/sda3　　           <span class="comment">#这是初始化刚才的分区3</span></span><br><span class="line">$ lvm&gt;vgdisplay						  <span class="comment">#查看卷组(VG Name)</span></span><br><span class="line">$ lvm&gt;vgextend centos /dev/sda3       <span class="comment">#将初始化过的分区加入到虚拟卷组centos</span></span><br><span class="line">$ lvm&gt;lvdisplay 					  <span class="comment">#查看逻辑分区，发现/dev/centos/root是根分区</span></span><br><span class="line">$ lvm&gt;lvextend /dev/mapper/centos-root /dev/sda3   <span class="comment">#此处将整个分区扩展到根分区上</span></span><br><span class="line">$ lvm&gt;pvdisplay 						<span class="comment">#查看卷容量，这时你会看到一个很大的卷了</span></span><br><span class="line">$ lvm&gt;quit 　							<span class="comment">#退出</span></span><br></pre></td></tr></table></figure>

<p>这一过程中因不合适操作初始化了一个<code>[unknown]</code>物理卷，导致无法继续正确拓展逻辑分区，参考【3】使用以下命令后恢复，注意不应该使用<code>vgremove</code>（其功能为删除卷组）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgreduce --removemissing <span class="comment"># 删除卷组中丢失的物理卷，使卷组恢复正常状态。</span></span><br></pre></td></tr></table></figure>

<h3><span id="扩容文件系统">扩容文件系统</span></h3><p>可以通过<code>df -T</code>查看文件系统类型，之前已格式化为<code>ext3</code>，执行以下命令完成扩容。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo resize2fs /dev/mapper/centos-root 		<span class="comment">#扩容文件系统，对应自己的根分区</span></span><br><span class="line"><span class="comment"># 如果报错或许因为扩容的是xfs文件系统，执行以下命令扩容文件系统</span></span><br><span class="line"><span class="comment"># $ sudo xfs_growfs /dev/centos/root </span></span><br><span class="line">$ sudo <span class="built_in">df</span> -h 		<span class="comment">#查看根分区容量已经更改</span></span><br><span class="line">$ sudo reboot		<span class="comment">#重启完成最后的操作</span></span><br></pre></td></tr></table></figure>



<h3><span id="references">References:</span></h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/climbsnail/p/12803025.html">博客园：virtualbox-centos扩容</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.0xzhang.com/posts/VirtualBox%E8%99%9A%E6%8B%9F%E6%9C%BACentOS7%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9.html">个人博客</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/11/17/system/linux/vmware/vmware%E6%89%A9%E5%AE%B9/" data-id="clp2sf5wq0000h19ahlfc8zbi" data-title="vmware扩容" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-bigdata/flink/flink_doc/flink_shangguigu" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/09/03/bigdata/flink/flink_doc/flink_shangguigu/" class="article-date">
  <time class="dt-published" datetime="2023-09-03T14:57:58.120Z" itemprop="datePublished">2023-09-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>1、flink shuffle 数据会落地吗， task之间数据流转是通过队列实现吗？</p>
<p>datastream模式下不会落地， Netwok buffer,  本质上是队列，</p>
<p>Deploy all subtasks of the job at the same time (for streaming applications)，</p>
<p>Sending data downstream as soon as it is produced, potentially one-by-one, either as a bounded or unbounded stream of records.</p>
<p>batch模式下会落地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">目前，Flink Shuffle 主要有 Pipelined Shuffle 和 Blocking Shuffle。其中，流式 Pipelined Shuffle 的上下游任务是同时运行的，大幅缩短任务的运行时间。同时，其数据可以在任务间直接传递，不需要落盘。</span><br><span class="line"></span><br><span class="line">但是目前 Pipelined Shuffle 在批场景下，仍处于生产不可用的状态。因为它在上下游同时运行时，资源需求较高。如果同时存在多个任务，每个任务只能拿到一部分资源，很容易形成资源调度的死锁。</span><br><span class="line"></span><br><span class="line">批式 Blocking Shuffle 有更好的资源自适应能力。在极限情况下，我们可以用一个 slot 执行完所有任务。但是它的性能较慢，因为批任务按 stage 调度的方式运行，每个 stage 都需要等待长尾任务完成。其次，它的数据需要全部落盘，导致 IO 开销较大。</span><br><span class="line"></span><br><span class="line">由此可见，不管是流式 Shuffle 还是批式 Shuffle，它们在某种特定的情况下，都会出现资源碎片的现象，即虽然持有资源却不能够调度任务并执行，从而会造成资源浪费。</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://flink.apache.org/2019/06/05/a-deep-dive-into-flinks-network-stack/#credit-based-flow-control">https://flink.apache.org/2019/06/05/a-deep-dive-into-flinks-network-stack/#credit-based-flow-control</a></p>
<p><a target="_blank" rel="noopener" href="https://flink.apache.org/2019/07/23/flink-network-stack-vol.-2-monitoring-metrics-and-that-backpressure-thing/#backpressure">https://flink.apache.org/2019/07/23/flink-network-stack-vol.-2-monitoring-metrics-and-that-backpressure-thing/#backpressure</a></p>
<p><a target="_blank" rel="noopener" href="https://www.modb.pro/db/601762">Flink shuffle衍化</a></p>
<p>Datastream \ keyedSteam\ splitstream\connectstream</p>
<p>Transform:</p>
<p>map\flatmap\filter\keyBy\min\minby\reduce\split\select\connect\comap</p>
<p>2、事务型写入的两种方式：</p>
<p>(1) write-ahead-log</p>
<p>(2) 2pc</p>
<p>a. checkpoint 超时时间 &lt;&#x3D; 外部sink事务超时时间,</p>
<p>b. 外部系统消费sink数据，事务隔离级别设置为read-commited</p>
<p>3、 三种流</p>
<p>Append:  insert</p>
<p>Retract:   retract  add</p>
<p>Upsert： upsert   delete</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/09/03/bigdata/flink/flink_doc/flink_shangguigu/" data-id="clp2sf5wt0001h19aaeyv8r0c" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-life/english" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/08/21/life/english/" class="article-date">
  <time class="dt-published" datetime="2023-08-21T03:49:08.000Z" itemprop="datePublished">2023-08-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/08/21/life/english/">english</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/08/21/life/english/" data-id="cllkcs12x00013x9a2qzg880k" data-title="english" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-life/health" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/08/21/life/health/" class="article-date">
  <time class="dt-published" datetime="2023-08-21T03:49:02.000Z" itemprop="datePublished">2023-08-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/life/">life</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/08/21/life/health/">health</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!-- toc -->

<ul>
<li><a href="#%E9%A3%9F%E8%B0%B1">食谱</a><ul>
<li><a href="#%E8%82%9D">肝</a></li>
</ul>
</li>
<li><a href="#%E8%BF%90%E5%8A%A8">运动</a><ul>
<li><a href="#%E8%82%BE">肾</a></li>
</ul>
</li>
<li><a href="#%E4%B8%AD%E5%8C%BB">中医</a></li>
<li><a href="#%E6%96%87%E5%8C%96">文化</a></li>
</ul>
<!-- tocstop -->

<h2><span id="食谱">食谱</span></h2><h3><span id="肝">肝</span></h3><p>排毒：绿豆20g +  薏米仁 20g + 百合 10g  + 红枣</p>
<h2><span id="运动">运动</span></h2><h3><span id="肾">肾</span></h3><h2><span id="中医">中医</span></h2><p>中国几千年的文化瑰宝在流失，现代各种文化意识形态领域的入侵和渗透，官僚阶级腐败、老百姓生活水深火热。</p>
<p>住房、医疗、教育、文化、经济各个领域，极少数人在权利和资本的加持下，掌握了几乎社会全部资本，苦的是老百姓，几千年来一直如此。言论不自由、评论问题被封杀、各种媒体不正确的导向又误导了一部分人，法律的解释权归政府所有(公、检、法)，可悲可叹的社会。。。</p>
<p>咱也不能一直抱怨，过好自己的日子，有能力的情况下多去尽可能帮助他人、多做善事。。。。</p>
<p>中医是中华文化的一个重要的部分，要传承、要发展，要去学习。</p>
<p>中医集大成者：倪海厦</p>
<p>曲黎敏</p>
<h2><span id="文化">文化</span></h2><p>张至顺  道</p>
<p>曾仕强  </p>
<p>鲁迅  国民劣根性批判</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/08/21/life/health/" data-id="cllkcs12y00023x9ady0b4wje" data-title="health" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/health/" rel="tag">health</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-life/culture" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/08/21/life/culture/" class="article-date">
  <time class="dt-published" datetime="2023-08-21T03:48:51.000Z" itemprop="datePublished">2023-08-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/08/21/life/culture/">culture</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/08/21/life/culture/" data-id="cllkcs12u00003x9afm40giug" data-title="culture" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-life/fun/movie" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/08/21/life/fun/movie/" class="article-date">
  <time class="dt-published" datetime="2023-08-21T03:47:32.000Z" itemprop="datePublished">2023-08-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/life-fun/">life/fun</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/08/21/life/fun/movie/">movie</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!-- toc -->

<ul>
<li><a href="#%E6%9D%8E%E5%B0%8F%E9%BE%99">李小龙</a><ul>
<li><a href="#%E9%BE%99%E4%BA%89%E8%99%8E%E6%96%97">龙争虎斗</a></li>
<li><a href="#%E7%8C%9B%E9%BE%99%E8%BF%87%E6%B1%9F">猛龙过江</a></li>
</ul>
</li>
<li><a href="#%E8%8C%83%E4%BC%9F">范伟</a><ul>
<li><a href="#%E4%B8%8D%E6%88%90%E9%97%AE%E9%A2%98%E7%9A%84%E9%97%AE%E9%A2%98">不成问题的问题</a></li>
</ul>
</li>
<li><a href="#%E5%BC%A0%E5%9B%BD%E8%8D%A3">张国荣</a><ul>
<li><a href="#%E9%9C%B8%E7%8E%8B%E5%88%AB%E5%A7%AC">霸王别姬</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E4%BB%96">其他</a><ul>
<li><a href="#%E8%8C%B6%E9%A6%86">茶馆</a></li>
<li><a href="#%E8%8A%99%E8%93%89%E9%95%87">芙蓉镇</a></li>
</ul>
</li>
<li><a href="#%E5%9B%BD%E5%A4%96">国外</a><ul>
<li><a href="#%E8%82%96%E7%94%B3%E5%85%8B%E7%9A%84%E6%95%91%E8%B5%8E">肖申克的救赎</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h2><span id="李小龙">李小龙</span></h2><h3><span id="龙争虎斗">龙争虎斗</span></h3><h3><span id="猛龙过江">猛龙过江</span></h3><h2><span id="范伟">范伟</span></h2><h3><span id="不成问题的问题">不成问题的问题</span></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">反映现实社会：拍马屁的人一路上位，实实在在干活的人不被理解，最后被赶走</span><br></pre></td></tr></table></figure>



<h2><span id="张国荣">张国荣</span></h2><h3><span id="霸王别姬">霸王别姬</span></h3><h2><span id="其他">其他</span></h2><h3><span id="茶馆">茶馆</span></h3><h3><span id="芙蓉镇">芙蓉镇</span></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">刘晓庆、姜文主演，反映现实社会，官僚阶段腐败问题、老百姓水深火热</span><br></pre></td></tr></table></figure>





<h2><span id="国外">国外</span></h2><h3><span id="肖申克的救赎">肖申克的救赎</span></h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/08/21/life/fun/movie/" data-id="cllkcs12z00033x9a5sjuazn2" data-title="movie" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/movie/" rel="tag">movie</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ai/llm/prompt/wu_en_da_prompt" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/27/ai/llm/prompt/wu_en_da_prompt/" class="article-date">
  <time class="dt-published" datetime="2023-07-27T03:41:20.000Z" itemprop="datePublished">2023-07-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ai-llm-prompt/">ai/llm/prompt</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/27/ai/llm/prompt/wu_en_da_prompt/">wu_en_da_prompt</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!-- toc -->



<!-- tocstop -->

<p>Two Principles:</p>
<p>1、写出清晰而且具体的指示</p>
<p>吴恩达</p>
<p>2、给模型思考时间</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/07/27/ai/llm/prompt/wu_en_da_prompt/" data-id="clkkmbmk30000609adn9davvo" data-title="wu_en_da_prompt" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/llm/" rel="tag">llm</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ai/llm/langchain/langchain_usage_20230721" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/21/ai/llm/langchain/langchain_usage_20230721/" class="article-date">
  <time class="dt-published" datetime="2023-07-21T06:23:09.000Z" itemprop="datePublished">2023-07-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ai-llm-langchain/">ai/llm/langchain</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/21/ai/llm/langchain/langchain_usage_20230721/">langchain_usage_20230721</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!-- toc -->

<ul>
<li><a href="#basic">Basic</a><ul>
<li><a href="#purpose">Purpose</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#example">Example</a><ul>
<li><a href="#chain">Chain</a></li>
<li><a href="#agent">Agent</a><ul>
<li><a href="#example-1">Example</a></li>
</ul>
</li>
<li><a href="#memory">Memory</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#model-io">Model IO</a><ul>
<li><a href="#models">Models</a></li>
</ul>
</li>
<li><a href="#data-connection">Data Connection</a><ul>
<li><a href="#embeddings">Embeddings</a></li>
</ul>
</li>
<li><a href="#chain-1">Chain</a><ul>
<li><a href="#test">Test</a><ul>
<li><a href="#example1">Example1</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h1><span id="basic">Basic</span></h1><h2><span id="purpose">Purpose</span></h2><p><strong>一句话总结 langchain， 一个开发框架，开发者可以使用该框架 整合大语言模型 开发各种应用。</strong></p>
<p>通过langchain可以扩展大模型的能力，实现诸如实时搜索、自动拆解任务进行调度的功能。</p>
<p>官方解释：</p>
<p><strong>LangChain</strong> is a framework for developing applications powered by language models. </p>
<h2><span id="install">Install</span></h2><p>本地环境python 3.9</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/Library/Frameworks/Python.framework/Versions/3.9</span><br><span class="line">/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/</span><br></pre></td></tr></table></figure>

<p><strong>install langchain</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 最小化安装</span><br><span class="line">pip install langchain</span><br><span class="line"></span><br><span class="line"># install modules needed for the common LLM providers</span><br><span class="line">pip install langchain[llms]</span><br><span class="line"></span><br><span class="line"># 附加安装各种依赖, 所需时间可能较长</span><br><span class="line">pip install langchain[all]</span><br></pre></td></tr></table></figure>

<p>如果使用的是zsh, </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install &#x27;langchain[all]&#x27;</span><br></pre></td></tr></table></figure>



<h2><span id="example">Example</span></h2><p>pip install langchain</p>
<p>pip install openai</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OPENAI_API_KEY=&quot;sk-***&quot;</span><br><span class="line"></span><br><span class="line">from langchain.llms import OpenAI</span><br><span class="line">llm = OpenAI(openai_api_key=OPENAI_API_KEY, temperature=0.9)</span><br><span class="line">llm.predict(&quot;What would be a good company name for a company that makes colorful socks?&quot;)</span><br><span class="line"># &gt;&gt; Feetful of Fun</span><br></pre></td></tr></table></figure>

<h3><span id="chain">Chain</span></h3><p>Chain 将模型、prompt 和其他 chain链接在一起，(用于执行完成各种任务)</p>
<p> Chains give us a way to link (or chain) together multiple primitives, like models, prompts, and other chains.</p>
<p><strong>示例中 基于 llm 和prompt  生成了一条chain</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">OPENAI_API_KEY = &quot;sk-**&quot;</span><br><span class="line"></span><br><span class="line">from langchain.llms import OpenAI</span><br><span class="line"># llm = OpenAI(openai_api_key=OPENAI_API_KEY, temperature=0.9)</span><br><span class="line">llm = OpenAI(temperature=0.9)</span><br><span class="line"># resp = llm.predict(&quot;What would be a good company name for a company that makes colorful socks?&quot;)</span><br><span class="line"># print(resp)</span><br><span class="line"></span><br><span class="line">from langchain.prompts import PromptTemplate</span><br><span class="line">prompt = PromptTemplate.from_template(&quot;What is a good name for a company that makes &#123;product&#125;?&quot;)</span><br><span class="line">from langchain.chains import LLMChain</span><br><span class="line">chain = LLMChain(llm=llm, prompt=prompt)</span><br><span class="line">res = chain.run(&quot;colorful socks&quot;)</span><br><span class="line">print (res)</span><br></pre></td></tr></table></figure>



<h3><span id="agent">Agent</span></h3><p>基于模型 对复杂任务自动拆解， 自动判断各个子任务执行的顺序步骤，</p>
<p>通过被授权使用各种工具(包括google 搜索、数据库查询等) 顺序执行各个子任务，最后给出 任务最终执行结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">To handle complex workflows, we need to be able to dynamically choose actions based on inputs.</span><br><span class="line">Agents do just this: they use a language model to determine which actions to take and in what order. Agents are given access to tools, and they repeatedly choose a tool, run the tool, and observe the output until they come up with a final answer.</span><br></pre></td></tr></table></figure>



<h4><span id="example">Example</span></h4><p>1、install the python package: pip install google-search-results</p>
<p>2、log in the site to get SERPER_API_KEY: <a target="_blank" rel="noopener" href="https://serper.dev/">https://serper.dev/</a>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">from langchain.llms import OpenAI</span><br><span class="line">os.environ[&quot;SERPER_API_KEY&quot;] = &quot;**&quot;</span><br><span class="line">os.environ[&quot;OPENAI_API_KEY&quot;] = &quot;***&quot;</span><br><span class="line"></span><br><span class="line">from langchain.agents import AgentType, initialize_agent, load_tools</span><br><span class="line">from langchain.llms import OpenAI</span><br><span class="line"></span><br><span class="line">from langchain.agents import AgentType, initialize_agent, load_tools</span><br><span class="line">from langchain.llms import OpenAI</span><br><span class="line"></span><br><span class="line"># The language model we&#x27;re going to use to control the agent.</span><br><span class="line">llm = OpenAI(temperature=0)</span><br><span class="line"></span><br><span class="line"># The tools we&#x27;ll give the Agent access to. Note that the &#x27;llm-math&#x27; tool uses an LLM, so we need to pass that in.</span><br><span class="line">tools = load_tools([&quot;google-serper&quot;, &quot;llm-math&quot;], llm=llm)</span><br><span class="line"></span><br><span class="line"># Finally, let&#x27;s initialize an agent with the tools, the language model, and the type of agent we want to use.</span><br><span class="line">agent = initialize_agent(tools, llm, agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION, verbose=True)</span><br><span class="line"></span><br><span class="line"># Let&#x27;s test it out!</span><br><span class="line">#res = agent.run(&quot;What was the high temperature in SF yesterday in Fahrenheit? What is that number raised to the .023 power?&quot;)</span><br><span class="line">res = agent.run(&quot;What was the newest version of apache spark ? What is that next version? Imaging they are two floats, give me the diff of them &quot;)</span><br><span class="line"></span><br><span class="line">print(res)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3><span id="memory">Memory</span></h3><p>构建有状态应用，基于上下文(之前的输入输出和当前的输入)信息 进行当前输出</p>
<h1><span id="model-io">Model IO</span></h1><p>IO 输入输出 模块</p>
<h2><span id="models">Models</span></h2><p>支持两类模型： llms 和chat models.</p>
<p>前者输入输出都是文本，后者输入输出都是 chat messages</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Chat models are a variation on language models. While chat models use language models under the hood, the interface they expose is a bit different. Rather than expose a &quot;text in, text out&quot; API, they expose an interface where &quot;chat messages&quot; are the inputs and outputs.</span><br></pre></td></tr></table></figure>



<h1><span id="data-connection">Data Connection</span></h1><p>如何加载外部数据</p>
<h2><span id="embeddings">Embeddings</span></h2><p>文本向量化</p>
<p>Embeddings create a vector representation of a piece of text. This is useful because it means we can think about text in the vector space, and do things like semantic search where we look for pieces of text that are most similar in the vector space.</p>
<h1><span id="chain">Chain</span></h1><p>Chain 将模型、prompt 和其他 chain链接在一起，(用于执行完成各种任务)</p>
<h2><span id="test">Test</span></h2><h3><span id="example1">Example1</span></h3><p>查询mysql，返回结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">import langchain</span><br><span class="line">from langchain.llms import OpenAI</span><br><span class="line">os.environ[&quot;SERPER_API_KEY&quot;] = &quot;**&quot;</span><br><span class="line">os.environ[&quot;OPENAI_API_KEY&quot;] = &quot;sk-**&quot;</span><br><span class="line"></span><br><span class="line"># pip install pymysql</span><br><span class="line">from langchain import OpenAI, SQLDatabase, SQLDatabaseChain</span><br><span class="line"></span><br><span class="line"># 密码含有特殊字符处理</span><br><span class="line">from urllib import parse</span><br><span class="line">pwd = parse.quote_plus(&quot;Zoom@123&quot;)</span><br><span class="line"></span><br><span class="line">db = SQLDatabase.from_uri(f&quot;mysql+pymysql://root:&#123;pwd&#125;@localhost:3306/test_zhou&quot;, include_tables=[&#x27;users&#x27;,&#x27;users2&#x27;])</span><br><span class="line">llm = OpenAI(temperature=0, verbose=True)</span><br><span class="line">db_chain = SQLDatabaseChain.from_llm(llm, db, verbose=True)</span><br><span class="line">#query = &quot;how many users in the users table&quot;</span><br><span class="line">query = &quot;how many users in the users table  have the same id as the users2 in the users2 table &quot;</span><br><span class="line">query = &quot;please give me a image that describes the addr distribution of users in the users table &quot;</span><br><span class="line">res = db_chain.run(query)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/07/21/ai/llm/langchain/langchain_usage_20230721/" data-id="clkj1iymy0000xu9a10lyerln" data-title="langchain_usage_20230721" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/llm/" rel="tag">llm</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-bigdata/kafka/kafka_basic" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/21/bigdata/kafka/kafka_basic/" class="article-date">
  <time class="dt-published" datetime="2023-07-21T02:45:53.000Z" itemprop="datePublished">2023-07-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata-kafka/">bigdata/kafka</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/21/bigdata/kafka/kafka_basic/">kafka_basic</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!-- toc -->

<ul>
<li><a href="#concepts">Concepts</a><ul>
<li><a href="#consumer">Consumer</a><ul>
<li><a href="#consumer-group">consumer group</a><ul>
<li><a href="#rebalance">Rebalance</a></li>
</ul>
</li>
<li><a href="#coordinator">Coordinator</a></li>
</ul>
</li>
<li><a href="#replica">Replica</a></li>
<li><a href="#controller">Controller</a></li>
</ul>
</li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#test">Test</a></li>
</ul>
</li>
<li><a href="#client">Client</a><ul>
<li><a href="#%E6%B6%88%E6%81%AF%E6%97%A0%E4%B8%A2%E5%A4%B1%E9%85%8D%E7%BD%AE">消息无丢失配置</a></li>
<li><a href="#%E6%B6%88%E6%81%AF%E5%B9%82%E7%AD%89">消息幂等</a><ul>
<li><a href="#%E5%B9%82%E7%AD%89%E5%9E%8Bproducer">幂等型producer</a><ul>
<li><a href="#feature">Feature</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8B%E5%8A%A1%E5%9E%8Bproducer">事务型producer</a><ul>
<li><a href="#%E7%89%B9%E7%82%B9">特点</a></li>
<li><a href="#usage-1">Usage</a></li>
</ul>
</li>
<li><a href="#%E5%AF%B9%E6%AF%94">对比</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h2><span id="concepts">Concepts</span></h2><p>Producer</p>
<p>Consumer</p>
<p>Broker</p>
<p>Topic  -&gt; partition -&gt; 1 leader + N flollower</p>
<p>（副本的工作机制也很简单：生产者总是向领导者副本写消息；而消费者总是从领导者副本读消息。至于追随者副本，它只做一件事：向领导者副本发送请求，请求领导者把最新生产的消息发给它，这样它能保持与领导者的同步。）</p>
<h3><span id="consumer">Consumer</span></h3><h4><span id="consumer-group">consumer group</span></h4><h5><span id="rebalance">Rebalance</span></h5><p>消费组重平衡，</p>
<p>Rebalance 本质上是一种协议，规定了一个 Consumer Group 下的所有 Consumer 如何达成一致，来分配订阅 Topic 的每个分区。</p>
<p>Rebalance触发条件：</p>
<p>1、消费组成员数发生变化</p>
<p>2、订阅主题数发生变更</p>
<p>3、订阅主题的分区数发生变更</p>
<p>Rebalance 过程中，所有 Consumer 实例都会停止消费，等待 Rebalance 完成</p>
<h4><span id="coordinator">Coordinator</span></h4><p>Coordinator，它专门为 Consumer Group 服务，负责为 consumer Group 执行 Rebalance 以及提供位移管理和组成员管理等</p>
<p>具体来讲，Consumer 端应用程序在提交位移时，其实是向 Coordinator 所在的 Broker 提交位移。同样地，当 Consumer 应用启动时，也是向 Coordinator 所在的 Broker 发送各种请求，然后由 Coordinator 负责执行消费者组的注册、成员管理记录等元数据管理操作。</p>
<p>所有 Broker 在启动时，都会创建和开启相应的 Coordinator 组件。也就是说，<strong>所有 Broker 都有各自的 Coordinator 组件</strong>。那么，Consumer Group 如何确定为它服务的 Coordinator 在哪台 Broker 上呢？</p>
<p>Kafka 为某个 Consumer Group 确定 Coordinator 所在的 Broker 的算法有 2 个步骤。</p>
<p>第 1 步：确定由位移主题的哪个分区来保存该 Group 数据：partitionId&#x3D;Math.abs(groupId.hashCode() % offsetsTopicPartitionCount)。</p>
<p>第 2 步：找出该分区 Leader 副本所在的 Broker，该 Broker 即为对应的 Coordinator。</p>
<h3><span id="replica">Replica</span></h3><p>leader</p>
<p>follower</p>
<p>LEO log-end-offset  </p>
<p>hw  high watermark</p>
<p>一个分区有3个副本，一个leader，2个follower。producer向leader写了10条消息，</p>
<p>follower1从leader处拷贝了5条消息，</p>
<p>follower2从leader处拷贝了3条消息，那么leader副本的LEO就是10，HW&#x3D;3；follower1副本的LEO是5。</p>
<p>请问一下，producer生产消息ack&#x3D;all的时候，消息是怎么保证到follower的，因为看到follower是异步拉取数据的，难道是看leader和follower上面的offset吗？</p>
<p>作者回复: 通过HW机制。leader处的HW要等所有follower LEO都越过了才会前移</p>
<h3><span id="controller">Controller</span></h3><p>控制器组件（Controller），是 Apache Kafka 的核心组件。它的主要作用是在 Apache ZooKeeper 的帮助下管理和协调整个 Kafka 集群。</p>
<p>集群中任意一台 Broker 都能充当控制器的角色，但是，在运行过程中，只能有一个 Broker 成为控制器，行使其管理和协调的职责。</p>
<p>Broker 在启动时，会尝试去 ZooKeeper 中创建 &#x2F;controller 节点。Kafka 当前选举控制器的规则是：第一个成功创建 &#x2F;controller 节点的 Broker 会被指定为控制器。</p>
<p>1、主题创建、删除；增加主题分区</p>
<p>2、分区重分配。分区重分配主要是指，kafka-reassign-partitions 脚本</p>
<p>3、Preferred leader选举。主要是 Kafka 为了避免部分 Broker 负载过重而提供的一种换 Leader 的方案</p>
<p>4、集群成员broker管理</p>
<p>5、数据服务。控制器上保存了最全的集群元数据信息，定期同步集群元数据信息到其他broker</p>
<h2><span id="usage">Usage</span></h2><h3><span id="test">Test</span></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cd /Users/***/Desktop/mydirect/github/software/apache-zookeeper-3.6.3-bin</span><br><span class="line">bin/zkServer.sh  start</span><br><span class="line">cd /Users/**/Desktop/mydirect/github/software/kafka_2.12-2.3.0</span><br><span class="line">bin/kafka-server-start.sh   config/server.properties </span><br><span class="line"></span><br><span class="line">bin/kafka-topics.sh --list --bootstrap-server localhost:9092</span><br><span class="line"></span><br><span class="line">bin/kafka-topics.sh  --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic testzq1</span><br><span class="line"></span><br><span class="line">bin/kafka-console-producer.sh  --broker-list localhost:9092  --topic testzq1</span><br><span class="line"></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server  localhost:9092 --topic testzq1 --from-beginning</span><br><span class="line"></span><br><span class="line">&#123;&quot;id&quot;:1, &quot;name&quot;:&quot;lii&quot;, &quot;cod&quot;:13&#125;</span><br><span class="line">&#123;&quot;id&quot;:6, &quot;name&quot;:&quot;fs&quot;, &quot;cod&quot;:13&#125;</span><br><span class="line">&#123;&quot;id&quot;:2, &quot;name&quot;:&quot;hz&quot;, &quot;cod&quot;:13&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;id&quot;:1, &quot;userid&quot;:&quot;42322&quot;, &quot;name&quot;:&quot;lisa&quot;, &quot;ts&quot;:1631172057&#125;</span><br><span class="line">&#123;&quot;id&quot;:2, &quot;userid&quot;:&quot;42322&quot;, &quot;name&quot;:&quot;bob&quot;, &quot;ts&quot;:1631172058&#125;</span><br><span class="line">&#123;&quot;id&quot;:3, &quot;userid&quot;:&quot;42322&quot;, &quot;name&quot;:&quot;lisa&quot;, &quot;ts&quot;:1631172057&#125;</span><br><span class="line">&#123;&quot;id&quot;:4, &quot;userid&quot;:&quot;42323&quot;, &quot;name&quot;:&quot;lisa&quot;, &quot;ts&quot;:1631172057&#125;</span><br></pre></td></tr></table></figure>



<h2><span id="client">Client</span></h2><h3><span id="消息无丢失配置">消息无丢失配置</span></h3><p>1、producer 使用带callback回调的send api发送消息，producer.send(msg, callback)</p>
<p>2、producer acks 设置 all，确保所有ISR 副本收到消息 (This means the leader will wait for the full set of in-sync replicas to acknowledge the record.)</p>
<p>3、producer设置 retries 为一个较大的值 </p>
<p>4、broker端 unclean.leader.election.enable &#x3D; false，某个broker 副本如何落后leader太多，无资格选择为新的leader （determine whether a replica that is not insync with the lead replica can itself become a leader in a failure scenario. <a target="_blank" rel="noopener" href="https://kafka.apache.org/documentation/#brokerconfigs">不在insync 状态的副本不能被选举为leader</a>）</p>
<p>5、broker端 replication.factor &gt;&#x3D; 3  副本因子设置，一条消息被保存 3份</p>
<p>6、broker端 min.insync.replicas &gt; 1 ，处于同步状态的副本数 &gt; 1，保证消息至少要被写入到多少个副本才算是“已提交”。设置成大于 1 可以提升消息持久性。在实际环境中千万不要使用默认值 1。</p>
<p>确保replication.factor &gt;  min.insync.replicas</p>
<p>7、确保消息消费完再提交。Consumer 端参数 enable.auto.commit 设置为false， 手动提交位移。</p>
<h3><span id="消息幂等">消息幂等</span></h3><h4><span id="幂等型producer">幂等型producer</span></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">props.put(“enable.idempotence”, ture) </span><br><span class="line">或 props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG， true)</span><br></pre></td></tr></table></figure>

<h5><span id="feature">Feature</span></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、它只能保证单分区上的幂等性，即一个幂等性 Producer 能够保证某个主题的一个分区上不出现重复消息，它无法实现多个分区的幂等性。</span><br><span class="line"></span><br><span class="line">2、其次，它只能实现单会话上的幂等性，不能实现跨会话的幂等性。这里的会话，你可以理解为 Producer 进程的一次运行。当你重启了 Producer 进程之后，这种幂等性保证就丧失了。</span><br></pre></td></tr></table></figure>

<h4><span id="事务型producer">事务型producer</span></h4><h5><span id="特点">特点</span></h5><p>1、事务型 Producer 能够保证将消息原子性地写入到多个分区中。这批消息要么全部写入成功，要么全部失败。</p>
<p>2、另外，事务型 Producer 也不惧进程的重启。Producer 重启回来后，Kafka 依然保证它们发送消息的精确一次处理。</p>
<h5><span id="usage">Usage</span></h5><p>和幂等性 Producer 一样，开启 enable.idempotence &#x3D; true。</p>
<p>设置 Producer 端参数 transactional. id。最好为其设置一个有意义的名字。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">producer.initTransactions();</span><br><span class="line">try &#123;</span><br><span class="line">            producer.beginTransaction();</span><br><span class="line">            producer.send(record1);</span><br><span class="line">            producer.send(record2);</span><br><span class="line">            producer.commitTransaction();</span><br><span class="line">&#125; catch (KafkaException e) &#123;</span><br><span class="line">            producer.abortTransaction();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 Consumer 端，读取事务型 Producer发送的消息，设置 isolation.level &#x3D; read_committed</p>
<h4><span id="对比">对比</span></h4><p>幂等型 Producer 和事务型 Producer 都是 Kafka 社区力图为 Kafka 实现精确一次处理语义所提供的工具，只是它们的作用范围是不同的。</p>
<p>幂等型 Producer 只能保证单分区、单会话上的消息幂等性；</p>
<p>而事务型 Producer 能够保证跨分区、跨会话间的幂等性。从交付语义上来看，自然是事务型 Producer 能做的更多。</p>
<p>比起幂等性 Producer，事务型 Producer 的性能要更差，在实际使用过程中，我们需要仔细评估引入事务的开销，切不可无脑地启用事务。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/07/21/bigdata/kafka/kafka_basic/" data-id="clkc3990000002x9aa1t866ra" data-title="kafka_basic" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kafka/" rel="tag">kafka</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-bigdata/spark/spark_tune/spark_conf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/21/bigdata/spark/spark_tune/spark_conf/" class="article-date">
  <time class="dt-published" datetime="2023-07-21T01:41:33.000Z" itemprop="datePublished">2023-07-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/21/bigdata/spark/spark_tune/spark_conf/">spark_conf</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://qingfengzhou.github.io/2023/07/21/bigdata/spark/spark_tune/spark_conf/" data-id="clkbxq01q0000t29abxe60644" data-title="spark_conf" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ai-llm-langchain/">ai/llm/langchain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ai-llm-prompt/">ai/llm/prompt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-flink-flink-doc/">bigdata/flink/flink_doc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-hadoop-hadoop-env/">bigdata/hadoop/hadoop_env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-kafka/">bigdata/kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-nosql-hbase/">bigdata/nosql/hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-spark/">bigdata/spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-spark-spark3/">bigdata/spark/spark3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-spark-spark-env/">bigdata/spark/spark_env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-spark-spark-tune/">bigdata/spark/spark_tune</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-spark-sparksql-kyuubi/">bigdata/spark/sparksql/kyuubi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata-sql/">bigdata/sql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java-concurrent/">java/concurrent</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java-designpattern/">java/designpattern</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java-jvm/">java/jvm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life-daily/">life/daily</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life-fun/">life/fun</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life-thought/">life/thought</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-linux-ansible/">system/linux/ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-linux-command/">system/linux/command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-linux-host-monitor/">system/linux/host/monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-linux-prometheus/">system/linux/prometheus</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-linux-vmware/">system/linux/vmware</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools-draw-%E5%9C%A8%E7%BA%BF%E7%94%BB%E5%9B%BE/">tools/draw/在线画图</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools-github-hexo/">tools/github/hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools-java-maven/">tools/java/maven</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/flink/" rel="tag">flink</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/" rel="tag">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/health/" rel="tag">health</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/llm/" rel="tag">llm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/movie/" rel="tag">movie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/" rel="tag">spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/" rel="tag">tools</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/flink/" style="font-size: 10px;">flink</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/health/" style="font-size: 10px;">health</a> <a href="/tags/java/" style="font-size: 16.67px;">java</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/llm/" style="font-size: 13.33px;">llm</a> <a href="/tags/movie/" style="font-size: 10px;">movie</a> <a href="/tags/spark/" style="font-size: 20px;">spark</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/17/system/linux/vmware/vmware%E6%89%A9%E5%AE%B9/">vmware扩容</a>
          </li>
        
          <li>
            <a href="/2023/09/03/bigdata/flink/flink_doc/flink_shangguigu/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/08/21/life/english/">english</a>
          </li>
        
          <li>
            <a href="/2023/08/21/life/health/">health</a>
          </li>
        
          <li>
            <a href="/2023/08/21/life/culture/">culture</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>